---
// Simple wrapper to wrap existing MDX code blocks with a copy button
// MDX passes child pre elements here
---

<div class="code-block-wrapper relative group my-6">
  <button 
    class="copy-btn absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity bg-surface border border-border text-xs px-2 py-1 rounded text-primary hover:text-accent hover:border-accent"
    aria-label="Copy code"
  >
    Copy
  </button>
  <div class="overflow-x-auto rounded-lg border border-border bg-[#0d1117] p-4 text-sm code-content">
    <slot />
  </div>
</div>

<script>
  // Setup copy buttons
  document.querySelectorAll('.copy-btn').forEach((btn) => {
    btn.addEventListener('click', async (e) => {
      const target = e.currentTarget as HTMLButtonElement;
      const wrapper = target.closest('.code-block-wrapper');
      
      // Get the code element inside the slot
      const codeElement = wrapper?.querySelector('code');
      const textToCopy = codeElement?.innerText || '';
      
      if (textToCopy) {
        try {
          await navigator.clipboard.writeText(textToCopy);
          
          const ogText = target.innerText;
          target.innerText = 'Copied!';
          target.classList.add('text-green-400', 'border-green-400');
          
          setTimeout(() => {
            target.innerText = ogText;
            target.classList.remove('text-green-400', 'border-green-400');
          }, 2000);
        } catch (err) {
          console.error('Failed to copy', err);
        }
      }
    });
  });
</script>

<style>
  /* Fix scrollbars for code blocks natively */
  .code-content::-webkit-scrollbar {
    height: 8px;
    background-color: transparent;
  }
  .code-content::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
    border-radius: 4px;
  }
</style>

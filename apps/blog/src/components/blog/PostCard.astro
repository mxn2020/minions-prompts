---
import { type CollectionEntry } from 'astro:content';
import TagBadge from './TagBadge.astro';

interface Props {
  post: CollectionEntry<'posts'>;
}

const { post } = Astro.props;

// Simple read time estimation (assuming standard markdown structure)
// We'll approximate 200 words per minute if we had body, but Astro 5 content collections don't easily export body without rendering.
// So we use a rough heuristic, or a placeholder if body isn't passed yet.
const wordCount = post.body?.split(/\s+/g).length || 500;
const readTime = Math.ceil(wordCount / 200);

const dateFmt = new Intl.DateTimeFormat('en-US', {
  month: 'short',
  day: 'numeric',
  year: 'numeric'
}).format(post.data.date);
---

<article class="flex flex-col gap-4 p-6 rounded-xl border border-border bg-surface hover:border-accent/50 transition-colors group">
  {post.data.coverImage && (
    <div class="w-full h-48 rounded-lg overflow-hidden bg-background mb-2">
      <img 
        src={post.data.coverImage} 
        alt={`Cover for ${post.data.title}`} 
        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" 
      />
    </div>
  )}
  
  <div class="flex items-center gap-2 text-xs text-muted">
    <time datetime={post.data.date.toISOString()}>{dateFmt}</time>
    <span>•</span>
    <span>{readTime} min read</span>
    <span>•</span>
    <span>{post.data.author}</span>
  </div>

  <h2 class="text-xl font-bold text-primary group-hover:text-accent transition-colors">
    <a href={`/posts/${post.id}`} class="focus:outline-none">
      <span class="absolute inset-0" aria-hidden="true"></span>
      {post.data.title}
    </a>
  </h2>
  
  <p class="text-sm text-muted line-clamp-3">
    {post.data.description}
  </p>

  {post.data.tags && post.data.tags.length > 0 && (
    <div class="flex flex-wrap gap-2 mt-auto pt-4 relative z-10">
      {post.data.tags.map(tag => (
        <TagBadge tag={tag} />
      ))}
    </div>
  )}
</article>
